Sprint 004 – 2025-10-13
=======================

Context
- Goal: Stop ambiguous Gradio errors (e.g., "Value 64 is less than minimum 128") by surfacing which component caused them.
- Constraint: No fallbacks or silent corrections; fail fast with context.

Completed
- Added contextual error wrapping for `gr.Slider` and `gr.Dropdown` preprocess in `modules/ui_gradio_extensions.py`.
  - Re-raise original exception type with `label`, `elem_id`, bounds (`min`, `max`, `step`), `default`, and `payload/coerced`.
  - Removed the legacy substitution of textual `'none'/'null'` to slider defaults (violated no‑fallback policy).
- Updated `NEWS.md` with user-visible note.
 - Strict submit payloads (phase 1):
   - JS (`javascript/ui.js`) now builds a compact strict JSON (`*_named_active`) with `__strict_version`, `__active_ids`, and apenas campos ativos (HR quando ligado; inpaint só nas abas de inpaint).
   - txt2img: UI envia apenas `[id_task, ...custom_script_inputs, payload_json]`; servidor chama `txt2img_from_json`.
   - img2img: mantém imagens/arquivos como inputs; todos escalares vão no JSON; servidor chama `img2img_from_json`.
   - Renomeado hidden JSON de `*_named_override` → `*_named_active`.

Files touched
- modules/ui_gradio_extensions.py
- NEWS.md
- codex/sprint-logs/2025-10-13_sprint-004.md
 - modules/ui.py
 - javascript/ui.js

Validation
- Static review: wrapper catches `TypeError`/`ValueError`/`gradio.exceptions.Error` and re-raises with context while preserving the original exception type.
- Searched codebase for min=128 sliders; likely offenders include ControlNet preprocessor resolution. The new errors will name the specific slider (label/elem_id) to locate the origin.
 - Strict payloads: verified indices mapping against `txt2img_inputs` and `submit_img2img_inputs`; ensured HR gating uses `txt2img_hr_enable` and inpaint gating uses `img2img_selected_tab`.

Risks / Follow-ups
- Some extensions may rely on the previous silent `'none'/'null'` substitution. If encountered, fix the sender to emit a valid numeric value instead.
- Consider adding similar guards for `gr.Number` if we see recurring issues.
 - Phase 2: migrate generate endpoints to accept a single JSON payload (via `gr.api`), reducing on-wire size instead of only server-side gating.

Next Sprint
- Trace and correct the origin sending out-of-bounds values (e.g., ControlNet pixel-perfect resolution emitting 64 when min is 128) so the UI always sends valid payloads.
 - Extend strict named override to extension groups (e.g., ControlNet Units) by defining their active sets and ids.
