Sprint 1 – 2025-10-16
=====================

Context
- Scope: Fix crash when Slider receives None payload during startup/load; reported on Dynamic Thresholding → "Mimic Scale".
- Goals: Prevent sending/processing unusable params; keep strict failure for invalid inputs; no UI regression.
- Constraints/flags: Gradio 5.x, SSR disabled by default, JS allow/deny lists active.

Completed
- Changes: Adjusted server-side Gradio Slider guard to treat missing payloads (`None`, and `'none'/'null'` sentinels) as "not provided" and substitute the component default (`value`). Keeps errors for invalid/out-of-bounds values. Added NEWS entry.
- Changes: Added Radio/Checkbox guards (type normalization + defaults) to stop early mismatches.
- Changes: Introduced named JSON for Dynamic Thresholding (elem_ids + DOM readers), and server-side reconstruction of `script_args` from payload; stopped including extension controls positionally in txt2img/img2img submits.
- Files touched: modules/ui_gradio_extensions.py, modules/scripts.py, modules/txt2img.py, modules/img2img.py, modules/ui.py, javascript/ui.js, extensions-builtin/sd_forge_dynamic_thresholding/scripts/forge_dynamic_thresholding.py, NEWS.md
- Env/config changes: None

Validation
- Steps run: Static review; ensured sliders/radios/checkboxes preprocess guards cover None/int/string and choice mapping; verified submit input lists drop custom script inputs and JSON includes dynthres + script index; mapped payload to script_args order.
- Results: Expected to resolve `TypeError: '<' not supported between instances of 'NoneType' and 'float'` and Radio choice errors during startup/load. Unused extension params are no longer sent in submits.

Addendum (2025-10-17)
- Strict builders now include typed core fields (prompt, styles, batch, cfg/distilled cfg, width/height, steps, sampler, scheduler, seed); img2img parity.
- Preset-aware defaults applied (SD/XL/Flux): sampler/scheduler values and basic WH/CFG updated on preset switch.
- Strict-mode enforced end-to-end (no legacy fallbacks, no auto-injection).
- Console/Network errors: None observed locally in code review. Runtime verification recommended.

Risks / Follow-ups
- Some events might still send unused inputs; longer-term we should tighten event wiring to not include extension controls in unrelated startup events.
- Consider mirroring this guard to `gr.Number` if similar None payloads are reported.

Next Sprint
- Audit event inputs for startup/load to exclude extension components where possible.
